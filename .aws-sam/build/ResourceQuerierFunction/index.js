"use strict";var en=Object.create;var Wt=Object.defineProperty;var tn=Object.getOwnPropertyDescriptor;var rn=Object.getOwnPropertyNames;var sn=Object.getPrototypeOf,nn=Object.prototype.hasOwnProperty;var f=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var on=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of rn(e))!nn.call(t,n)&&n!==r&&Wt(t,n,{get:()=>e[n],enumerable:!(s=tn(e,n))||s.enumerable});return t};var an=(t,e,r)=>(r=t!=null?en(sn(t)):{},on(e||!t||!t.__esModule?Wt(r,"default",{value:t,enumerable:!0}):r,t));var Ae=f(Vt=>{"use strict";Vt.parse=function(t,e){return new V(t,e).parse()};var V=class{constructor(e,r){this.source=e,this.transform=r||un,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var r;(this.recorded.length>0||e)&&(r=this.recorded.join(""),r==="NULL"&&!e&&(r=null),r!==null&&(r=this.transform(r)),this.entries.push(r),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var r,s,n;for(this.consumeDimensions();!this.isEof();)if(r=this.nextCharacter(),r.value==="{"&&!n)this.dimension++,this.dimension>1&&(s=new V(this.source.substr(this.position-1),this.transform),this.entries.push(s.parse(!0)),this.position+=s.position-2);else if(r.value==="}"&&!n){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else r.value==='"'&&!r.escaped?(n&&this.newEntry(!0),n=!n):r.value===","&&!n?this.newEntry():this.record(r.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function un(t){return t}});var Te=f((Ia,Yt)=>{var cn=Ae();Yt.exports={create:function(t,e){return{parse:function(){return cn.parse(t,e)}}}}});var xe=f((Oa,Kt)=>{"use strict";var hn=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,ln=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,fn=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,pn=/^-?infinity$/;Kt.exports=function(e){if(pn.test(e))return Number(e.replace("i","I"));var r=hn.exec(e);if(!r)return dn(e)||null;var s=!!r[8],n=parseInt(r[1],10);s&&(n=zt(n));var i=parseInt(r[2],10)-1,o=r[3],u=parseInt(r[4],10),a=parseInt(r[5],10),c=parseInt(r[6],10),h=r[7];h=h?1e3*parseFloat(h):0;var l,d=yn(e);return d!=null?(l=new Date(Date.UTC(n,i,o,u,a,c,h)),Me(n)&&l.setUTCFullYear(n),d!==0&&l.setTime(l.getTime()-d)):(l=new Date(n,i,o,u,a,c,h),Me(n)&&l.setFullYear(n)),l};function dn(t){var e=ln.exec(t);if(!!e){var r=parseInt(e[1],10),s=!!e[4];s&&(r=zt(r));var n=parseInt(e[2],10)-1,i=e[3],o=new Date(r,n,i);return Me(r)&&o.setFullYear(r),o}}function yn(t){if(t.endsWith("+00"))return 0;var e=fn.exec(t.split(" ")[1]);if(!!e){var r=e[1];if(r==="Z")return 0;var s=r==="-"?-1:1,n=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return n*s*1e3}}function zt(t){return-(t-1)}function Me(t){return t>=0&&t<100}});var Zt=f((ka,Jt)=>{Jt.exports=vn;var mn=Object.prototype.hasOwnProperty;function vn(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)mn.call(r,s)&&(t[s]=r[s])}return t}});var Ie=f((Da,er)=>{"use strict";var _n=Zt();er.exports=D;function D(t){if(!(this instanceof D))return new D(t);_n(this,xn(t))}var gn=["seconds","minutes","hours","days","months","years"];D.prototype.toPostgres=function(){var t=gn.filter(this.hasOwnProperty,this);return this.milliseconds&&t.indexOf("seconds")<0&&t.push("seconds"),t.length===0?"0":t.map(function(e){var r=this[e]||0;return e==="seconds"&&this.milliseconds&&(r=(r+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),r+" "+e},this).join(" ")};var wn={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},bn=["years","months","days"],En=["hours","minutes","seconds"];D.prototype.toISOString=D.prototype.toISO=function(){var t=bn.map(r,this).join(""),e=En.map(r,this).join("");return"P"+t+"T"+e;function r(s){var n=this[s]||0;return s==="seconds"&&this.milliseconds&&(n=(n+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),n+wn[s]}};var qe="([+-]?\\d+)",Sn=qe+"\\s+years?",Pn=qe+"\\s+mons?",Cn=qe+"\\s+days?",Rn="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",An=new RegExp([Sn,Pn,Cn,Rn].map(function(t){return"("+t+")?"}).join("\\s*")),Xt={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Tn=["hours","minutes","seconds","milliseconds"];function Mn(t){var e=t+"000000".slice(t.length);return parseInt(e,10)/1e3}function xn(t){if(!t)return{};var e=An.exec(t),r=e[8]==="-";return Object.keys(Xt).reduce(function(s,n){var i=Xt[n],o=e[i];return!o||(o=n==="milliseconds"?Mn(o):parseInt(o,10),!o)||(r&&~Tn.indexOf(n)&&(o*=-1),s[n]=o),s},{})}});var Oe=f((La,tr)=>{"use strict";tr.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var r="",s=0;s<e.length;)if(e[s]!=="\\")r+=e[s],++s;else if(/[0-7]{3}/.test(e.substr(s+1,3)))r+=String.fromCharCode(parseInt(e.substr(s+1,3),8)),s+=4;else{for(var n=1;s+n<e.length&&e[s+n]==="\\";)n++;for(var i=0;i<Math.floor(n/2);++i)r+="\\";s+=Math.floor(n/2)*2}return new Buffer(r,"binary")}});var ur=f((Ba,ar)=>{var Y=Ae(),z=Te(),oe=xe(),sr=Ie(),nr=Oe();function ae(t){return function(r){return r===null?r:t(r)}}function ir(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}function qn(t){return t?Y.parse(t,ir):null}function In(t){return parseInt(t,10)}function ke(t){return t?Y.parse(t,ae(In)):null}function On(t){return t?Y.parse(t,ae(function(e){return or(e).trim()})):null}var kn=function(t){if(!t)return null;var e=z.create(t,function(r){return r!==null&&(r=Qe(r)),r});return e.parse()},De=function(t){if(!t)return null;var e=z.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},T=function(t){if(!t)return null;var e=z.create(t);return e.parse()},Le=function(t){if(!t)return null;var e=z.create(t,function(r){return r!==null&&(r=oe(r)),r});return e.parse()},Dn=function(t){if(!t)return null;var e=z.create(t,function(r){return r!==null&&(r=sr(r)),r});return e.parse()},Ln=function(t){return t?Y.parse(t,ae(nr)):null},Be=function(t){return parseInt(t,10)},or=function(t){var e=String(t);return/^\d+$/.test(e)?e:t},rr=function(t){return t?Y.parse(t,ae(JSON.parse)):null},Qe=function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},Bn=function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",s=!1,n=2;n<t.length-1;n++){if(s||(e+=t[n]),t[n]===")"){s=!0;continue}else if(!s)continue;t[n]!==","&&(r+=t[n])}var i=Qe(e);return i.radius=parseFloat(r),i},Qn=function(t){t(20,or),t(21,Be),t(23,Be),t(26,Be),t(700,parseFloat),t(701,parseFloat),t(16,ir),t(1082,oe),t(1114,oe),t(1184,oe),t(600,Qe),t(651,T),t(718,Bn),t(1e3,qn),t(1001,Ln),t(1005,ke),t(1007,ke),t(1028,ke),t(1016,On),t(1017,kn),t(1021,De),t(1022,De),t(1231,De),t(1014,T),t(1015,T),t(1008,T),t(1009,T),t(1040,T),t(1041,T),t(1115,Le),t(1182,Le),t(1185,Le),t(1186,sr),t(1187,Dn),t(17,nr),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,rr),t(3807,rr),t(3907,T),t(2951,T),t(791,T),t(1183,T),t(1270,T)};ar.exports={init:Qn}});var Fe=f((Qa,cr)=>{"use strict";var C=1e6;function Fn(t){var e=t.readInt32BE(0),r=t.readUInt32BE(4),s="";e<0&&(e=~e+(r===0),r=~r+1>>>0,s="-");var n="",i,o,u,a,c,h;{if(i=e%C,e=e/C>>>0,o=4294967296*i+r,r=o/C>>>0,u=""+(o-C*r),r===0&&e===0)return s+u+n;for(a="",c=6-u.length,h=0;h<c;h++)a+="0";n=a+u+n}{if(i=e%C,e=e/C>>>0,o=4294967296*i+r,r=o/C>>>0,u=""+(o-C*r),r===0&&e===0)return s+u+n;for(a="",c=6-u.length,h=0;h<c;h++)a+="0";n=a+u+n}{if(i=e%C,e=e/C>>>0,o=4294967296*i+r,r=o/C>>>0,u=""+(o-C*r),r===0&&e===0)return s+u+n;for(a="",c=6-u.length,h=0;h<c;h++)a+="0";n=a+u+n}return i=e%C,o=4294967296*i+r,u=""+o%C,s+u+n}cr.exports=Fn});var dr=f((Fa,pr)=>{var Nn=Fe(),v=function(t,e,r,s,n){r=r||0,s=s||!1,n=n||function(b,H,W){return b*Math.pow(2,W)+H};var i=r>>3,o=function(b){return s?~b&255:b},u=255,a=8-r%8;e<a&&(u=255<<8-e&255,a=e),r&&(u=u>>r%8);var c=0;r%8+e>=8&&(c=n(0,o(t[i])&u,a));for(var h=e+r>>3,l=i+1;l<h;l++)c=n(c,o(t[l]),8);var d=(e+r)%8;return d>0&&(c=n(c,o(t[h])>>8-d,d)),c},fr=function(t,e,r){var s=Math.pow(2,r-1)-1,n=v(t,1),i=v(t,r,1);if(i===0)return 0;var o=1,u=function(c,h,l){c===0&&(c=1);for(var d=1;d<=l;d++)o/=2,(h&1<<l-d)>0&&(c+=o);return c},a=v(t,e,r+1,!1,u);return i==Math.pow(2,r+1)-1?a===0?n===0?1/0:-1/0:NaN:(n===0?1:-1)*Math.pow(2,i-s)*a},Un=function(t){return v(t,1)==1?-1*(v(t,15,1,!0)+1):v(t,15,1)},hr=function(t){return v(t,1)==1?-1*(v(t,31,1,!0)+1):v(t,31,1)},Gn=function(t){return fr(t,23,8)},$n=function(t){return fr(t,52,11)},jn=function(t){var e=v(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,v(t,16,16)),s=0,n=[],i=v(t,16),o=0;o<i;o++)s+=v(t,16,64+16*o)*r,r/=1e4;var u=Math.pow(10,v(t,16,48));return(e===0?1:-1)*Math.round(s*u)/u},lr=function(t,e){var r=v(e,1),s=v(e,63,1),n=new Date((r===0?1:-1)*s/1e3+9466848e5);return t||n.setTime(n.getTime()+n.getTimezoneOffset()*6e4),n.usec=s%1e3,n.getMicroSeconds=function(){return this.usec},n.setMicroSeconds=function(i){this.usec=i},n.getUTCMicroSeconds=function(){return this.usec},n},K=function(t){for(var e=v(t,32),r=v(t,32,32),s=v(t,32,64),n=96,i=[],o=0;o<e;o++)i[o]=v(t,32,n),n+=32,n+=32;var u=function(c){var h=v(t,32,n);if(n+=32,h==4294967295)return null;var l;if(c==23||c==20)return l=v(t,h*8,n),n+=h*8,l;if(c==25)return l=t.toString(this.encoding,n>>3,(n+=h<<3)>>3),l;console.log("ERROR: ElementType not implemented: "+c)},a=function(c,h){var l=[],d;if(c.length>1){var b=c.shift();for(d=0;d<b;d++)l[d]=a(c,h);c.unshift(b)}else for(d=0;d<c[0];d++)l[d]=u(h);return l};return a(i,s)},Hn=function(t){return t.toString("utf8")},Wn=function(t){return t===null?null:v(t,8)>0},Vn=function(t){t(20,Nn),t(21,Un),t(23,hr),t(26,hr),t(1700,jn),t(700,Gn),t(701,$n),t(16,Wn),t(1114,lr.bind(null,!1)),t(1184,lr.bind(null,!0)),t(1e3,K),t(1007,K),t(1016,K),t(1008,K),t(1009,K),t(25,Hn)};pr.exports={init:Vn}});var mr=f((Na,yr)=>{yr.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var X=f(Z=>{var Yn=ur(),zn=dr(),Kn=Te(),Jn=mr();Z.getTypeParser=Zn;Z.setTypeParser=Xn;Z.arrayParser=Kn;Z.builtins=Jn;var J={text:{},binary:{}};function vr(t){return String(t)}function Zn(t,e){return e=e||"text",J[e]&&J[e][t]||vr}function Xn(t,e,r){typeof e=="function"&&(r=e,e="text"),J[e][t]=r}Yn.init(function(t,e){J.text[t]=e});zn.init(function(t,e){J.binary[t]=e})});var ee=f((Ga,Ne)=>{"use strict";Ne.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var L=X(),ei=L.getTypeParser(20,"text"),ti=L.getTypeParser(1016,"text");Ne.exports.__defineSetter__("parseInt8",function(t){L.setTypeParser(20,"text",t?L.getTypeParser(23,"text"):ei),L.setTypeParser(1016,"text",t?L.getTypeParser(1007,"text"):ti)})});var ce=f(($a,gr)=>{"use strict";var ri=require("crypto"),si=ee();function ni(t){var e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+e+'"'}function _r(t){for(var e="{",r=0;r<t.length;r++)r>0&&(e=e+","),t[r]===null||typeof t[r]>"u"?e=e+"NULL":Array.isArray(t[r])?e=e+_r(t[r]):t[r]instanceof Buffer?e+="\\\\x"+t[r].toString("hex"):e+=ni(ue(t[r]));return e=e+"}",e}var ue=function(t,e){if(t==null)return null;if(t instanceof Buffer)return t;if(ArrayBuffer.isView(t)){var r=Buffer.from(t.buffer,t.byteOffset,t.byteLength);return r.length===t.byteLength?r:r.slice(t.byteOffset,t.byteOffset+t.byteLength)}return t instanceof Date?si.parseInputDatesAsUTC?ai(t):oi(t):Array.isArray(t)?_r(t):typeof t=="object"?ii(t,e):t.toString()};function ii(t,e){if(t&&typeof t.toPostgres=="function"){if(e=e||[],e.indexOf(t)!==-1)throw new Error('circular reference detected while preparing "'+t+'" for query');return e.push(t),ue(t.toPostgres(ue),e)}return JSON.stringify(t)}function S(t,e){for(t=""+t;t.length<e;)t="0"+t;return t}function oi(t){var e=-t.getTimezoneOffset(),r=t.getFullYear(),s=r<1;s&&(r=Math.abs(r)+1);var n=S(r,4)+"-"+S(t.getMonth()+1,2)+"-"+S(t.getDate(),2)+"T"+S(t.getHours(),2)+":"+S(t.getMinutes(),2)+":"+S(t.getSeconds(),2)+"."+S(t.getMilliseconds(),3);return e<0?(n+="-",e*=-1):n+="+",n+=S(Math.floor(e/60),2)+":"+S(e%60,2),s&&(n+=" BC"),n}function ai(t){var e=t.getUTCFullYear(),r=e<1;r&&(e=Math.abs(e)+1);var s=S(e,4)+"-"+S(t.getUTCMonth()+1,2)+"-"+S(t.getUTCDate(),2)+"T"+S(t.getUTCHours(),2)+":"+S(t.getUTCMinutes(),2)+":"+S(t.getUTCSeconds(),2)+"."+S(t.getUTCMilliseconds(),3);return s+="+00:00",r&&(s+=" BC"),s}function ui(t,e,r){return t=typeof t=="string"?{text:t}:t,e&&(typeof e=="function"?t.callback=e:t.values=e),r&&(t.callback=r),t}var Ue=function(t){return ri.createHash("md5").update(t,"utf-8").digest("hex")},ci=function(t,e,r){var s=Ue(e+t),n=Ue(Buffer.concat([Buffer.from(s),r]));return"md5"+n};gr.exports={prepareValue:function(e){return ue(e)},normalizeQueryConfig:ui,postgresMd5PasswordHash:ci,md5:Ue}});var Pr=f((ja,Sr)=>{"use strict";var Ge=require("crypto");function hi(t){if(t.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let e=Ge.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:e,response:"n,,n=*,r="+e,message:"SASLInitialResponse"}}function li(t,e,r){if(t.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(typeof r!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let s=di(r);if(s.nonce.startsWith(t.clientNonce)){if(s.nonce.length===t.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var n=Buffer.from(s.salt,"base64"),i=vi(e,n,s.iteration),o=B(i,"Client Key"),u=mi(o),a="n=*,r="+t.clientNonce,c="r="+s.nonce+",s="+s.salt+",i="+s.iteration,h="c=biws,r="+s.nonce,l=a+","+c+","+h,d=B(u,l),b=Er(o,d),H=b.toString("base64"),W=B(i,"Server Key"),Xs=B(W,l);t.message="SASLResponse",t.serverSignature=Xs.toString("base64"),t.response=h+",p="+H}function fi(t,e){if(t.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:r}=yi(e);if(r!==t.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function pi(t){if(typeof t!="string")throw new TypeError("SASL: text must be a string");return t.split("").map((e,r)=>t.charCodeAt(r)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function wr(t){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(t)}function br(t){if(typeof t!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(t.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let r=e[0],s=e.substring(2);return[r,s]}))}function di(t){let e=br(t),r=e.get("r");if(r){if(!pi(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let s=e.get("s");if(s){if(!wr(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let n=e.get("i");if(n){if(!/^[1-9][0-9]*$/.test(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let i=parseInt(n,10);return{nonce:r,salt:s,iteration:i}}function yi(t){let r=br(t).get("v");if(r){if(!wr(r))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:r}}function Er(t,e){if(!Buffer.isBuffer(t))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(t.length!==e.length)throw new Error("Buffer lengths must match");if(t.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(t.map((r,s)=>t[s]^e[s]))}function mi(t){return Ge.createHash("sha256").update(t).digest()}function B(t,e){return Ge.createHmac("sha256",t).update(e).digest()}function vi(t,e,r){for(var s=B(t,Buffer.concat([e,Buffer.from([0,0,0,1])])),n=s,i=0;i<r-1;i++)s=B(t,s),n=Er(n,s);return n}Sr.exports={startSession:hi,continueSession:li,finalizeSession:fi}});var Tr=f((Ha,Ar)=>{"use strict";var{Transform:_i}=require("stream"),{StringDecoder:gi}=require("string_decoder"),I=Symbol("last"),he=Symbol("decoder");function wi(t,e,r){let s;if(this.overflow){if(s=this[he].write(t).split(this.matcher),s.length===1)return r();s.shift(),this.overflow=!1}else this[I]+=this[he].write(t),s=this[I].split(this.matcher);this[I]=s.pop();for(let n=0;n<s.length;n++)try{Rr(this,this.mapper(s[n]))}catch(i){return r(i)}if(this.overflow=this[I].length>this.maxLength,this.overflow&&!this.skipOverflow){r(new Error("maximum buffer reached"));return}r()}function bi(t){if(this[I]+=this[he].end(),this[I])try{Rr(this,this.mapper(this[I]))}catch(e){return t(e)}t()}function Rr(t,e){e!==void 0&&t.push(e)}function Cr(t){return t}function Ei(t,e,r){switch(t=t||/\r?\n/,e=e||Cr,r=r||{},arguments.length){case 1:typeof t=="function"?(e=t,t=/\r?\n/):typeof t=="object"&&!(t instanceof RegExp)&&(r=t,t=/\r?\n/);break;case 2:typeof t=="function"?(r=e,e=t,t=/\r?\n/):typeof e=="object"&&(r=e,e=Cr)}r=Object.assign({},r),r.autoDestroy=!0,r.transform=wi,r.flush=bi,r.readableObjectMode=!0;let s=new _i(r);return s[I]="",s[he]=new gi("utf8"),s.matcher=t,s.mapper=e,s.maxLength=r.maxLength,s.skipOverflow=r.skipOverflow||!1,s.overflow=!1,s._destroy=function(n,i){this._writableState.errorEmitted=!1,i(n)},s}Ar.exports=Ei});var qr=f((Wa,q)=>{"use strict";var Mr=require("path"),Si=require("stream").Stream,Pi=Tr(),xr=require("util"),Ci=5432,le=process.platform==="win32",te=process.stderr,Ri=56,Ai=7,Ti=61440,Mi=32768;function xi(t){return(t&Ti)==Mi}var Q=["host","port","database","user","password"],$e=Q.length,qi=Q[$e-1];function je(){var t=te instanceof Si&&te.writable===!0;if(t){var e=Array.prototype.slice.call(arguments).concat(`
`);te.write(xr.format.apply(xr,e))}}Object.defineProperty(q.exports,"isWin",{get:function(){return le},set:function(t){le=t}});q.exports.warnTo=function(t){var e=te;return te=t,e};q.exports.getFileName=function(t){var e=t||process.env,r=e.PGPASSFILE||(le?Mr.join(e.APPDATA||"./","postgresql","pgpass.conf"):Mr.join(e.HOME||"./",".pgpass"));return r};q.exports.usePgPass=function(t,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:le?!0:(e=e||"<unkn>",xi(t.mode)?t.mode&(Ri|Ai)?(je('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(je('WARNING: password file "%s" is not a plain file',e),!1))};var Ii=q.exports.match=function(t,e){return Q.slice(0,-1).reduce(function(r,s,n){return n==1&&Number(t[s]||Ci)===Number(e[s])?r&&!0:r&&(e[s]==="*"||e[s]===t[s])},!0)};q.exports.getPassword=function(t,e,r){var s,n=e.pipe(Pi());function i(a){var c=Oi(a);c&&ki(c)&&Ii(t,c)&&(s=c[qi],n.end())}var o=function(){e.destroy(),r(s)},u=function(a){e.destroy(),je("WARNING: error on reading file: %s",a),r(void 0)};e.on("error",u),n.on("data",i).on("end",o).on("error",u)};var Oi=q.exports.parseLine=function(t){if(t.length<11||t.match(/^\s+#/))return null;for(var e="",r="",s=0,n=0,i=0,o={},u=!1,a=function(h,l,d){var b=t.substring(l,d);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(b=b.replace(/\\([:\\])/g,"$1")),o[Q[h]]=b},c=0;c<t.length-1;c+=1){if(e=t.charAt(c+1),r=t.charAt(c),u=s==$e-1,u){a(s,n);break}c>=0&&e==":"&&r!=="\\"&&(a(s,n,c+1),n=c+2,s+=1)}return o=Object.keys(o).length===$e?o:null,o},ki=q.exports.isValidEntry=function(t){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},r=0;r<Q.length;r+=1){var s=e[r],n=t[Q[r]]||"",i=s(n);if(!i)return!1}return!0}});var Or=f((Ya,He)=>{"use strict";var Va=require("path"),Ir=require("fs"),fe=qr();He.exports=function(t,e){var r=fe.getFileName();Ir.stat(r,function(s,n){if(s||!fe.usePgPass(n,r))return e(void 0);var i=Ir.createReadStream(r);fe.getPassword(t,i,e)})};He.exports.warnTo=fe.warnTo});var We=f((za,kr)=>{"use strict";var Di=X();function pe(t){this._types=t||Di,this.text={},this.binary={}}pe.prototype.getOverrides=function(t){switch(t){case"text":return this.text;case"binary":return this.binary;default:return{}}};pe.prototype.setTypeParser=function(t,e,r){typeof e=="function"&&(r=e,e="text"),this.getOverrides(e)[t]=r};pe.prototype.getTypeParser=function(t,e){return e=e||"text",this.getOverrides(e)[t]||this._types.getTypeParser(t,e)};kr.exports=pe});var Lr=f((Ka,Dr)=>{"use strict";var Li=require("url"),Ve=require("fs");function Ye(t){if(t.charAt(0)==="/"){var r=t.split(" ");return{host:r[0],database:r[1]}}var e=Li.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(t)?encodeURI(t).replace(/\%25(\d\d)/g,"%$1"):t,!0),r=e.query;for(var s in r)Array.isArray(r[s])&&(r[s]=r[s][r[s].length-1]);var n=(e.auth||":").split(":");if(r.user=n[0],r.password=n.splice(1).join(":"),r.port=e.port,e.protocol=="socket:")return r.host=decodeURI(e.pathname),r.database=e.query.db,r.client_encoding=e.query.encoding,r;r.host||(r.host=e.hostname);var i=e.pathname;if(!r.host&&i&&/^%2f/i.test(i)){var o=i.split("/");r.host=decodeURIComponent(o[0]),i=o.splice(1).join("/")}switch(i&&i.charAt(0)==="/"&&(i=i.slice(1)||null),r.database=i&&decodeURI(i),(r.ssl==="true"||r.ssl==="1")&&(r.ssl=!0),r.ssl==="0"&&(r.ssl=!1),(r.sslcert||r.sslkey||r.sslrootcert||r.sslmode)&&(r.ssl={}),r.sslcert&&(r.ssl.cert=Ve.readFileSync(r.sslcert).toString()),r.sslkey&&(r.ssl.key=Ve.readFileSync(r.sslkey).toString()),r.sslrootcert&&(r.ssl.ca=Ve.readFileSync(r.sslrootcert).toString()),r.sslmode){case"disable":{r.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{r.ssl.rejectUnauthorized=!1;break}}return r}Dr.exports=Ye;Ye.parse=Ye});var Ke=f((Ja,Fr)=>{"use strict";var Bi=require("dns"),Qr=ee(),Br=Lr().parse,P=function(t,e,r){return r===void 0?r=process.env["PG"+t.toUpperCase()]:r===!1||(r=process.env[r]),e[t]||r||Qr[t]},Qi=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return Qr.ssl},F=function(t){return"'"+(""+t).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},M=function(t,e,r){var s=e[r];s!=null&&t.push(r+"="+F(s))},ze=class{constructor(e){e=typeof e=="string"?Br(e):e||{},e.connectionString&&(e=Object.assign({},e,Br(e.connectionString))),this.user=P("user",e),this.database=P("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(P("port",e),10),this.host=P("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:P("password",e)}),this.binary=P("binary",e),this.options=P("options",e),this.ssl=typeof e.ssl>"u"?Qi():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=P("client_encoding",e),this.replication=P("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=P("application_name",e,"PGAPPNAME"),this.fallback_application_name=P("fallback_application_name",e,!1),this.statement_timeout=P("statement_timeout",e,!1),this.lock_timeout=P("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=P("idle_in_transaction_session_timeout",e,!1),this.query_timeout=P("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var r=[];M(r,this,"user"),M(r,this,"password"),M(r,this,"port"),M(r,this,"application_name"),M(r,this,"fallback_application_name"),M(r,this,"connect_timeout"),M(r,this,"options");var s=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(M(r,s,"sslmode"),M(r,s,"sslca"),M(r,s,"sslkey"),M(r,s,"sslcert"),M(r,s,"sslrootcert"),this.database&&r.push("dbname="+F(this.database)),this.replication&&r.push("replication="+F(this.replication)),this.host&&r.push("host="+F(this.host)),this.isDomainSocket)return e(null,r.join(" "));this.client_encoding&&r.push("client_encoding="+F(this.client_encoding)),Bi.lookup(this.host,function(n,i){return n?e(n,null):(r.push("hostaddr="+F(i)),e(null,r.join(" ")))})}};Fr.exports=ze});var Gr=f((Za,Ur)=>{"use strict";var Fi=X(),Nr=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,Je=class{constructor(e,r){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=r,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(e){var r;e.text?r=Nr.exec(e.text):r=Nr.exec(e.command),r&&(this.command=r[1],r[3]?(this.oid=parseInt(r[2],10),this.rowCount=parseInt(r[3],10)):r[2]&&(this.rowCount=parseInt(r[2],10)))}_parseRowAsArray(e){for(var r=new Array(e.length),s=0,n=e.length;s<n;s++){var i=e[s];i!==null?r[s]=this._parsers[s](i):r[s]=null}return r}parseRow(e){for(var r={},s=0,n=e.length;s<n;s++){var i=e[s],o=this.fields[s].name;i!==null?r[o]=this._parsers[s](i):r[o]=null}return r}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var r=0;r<e.length;r++){var s=e[r];this._types?this._parsers[r]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[r]=Fi.getTypeParser(s.dataTypeID,s.format||"text")}}};Ur.exports=Je});var Wr=f((Xa,Hr)=>{"use strict";var{EventEmitter:Ni}=require("events"),$r=Gr(),jr=ce(),Ze=class extends Ni{constructor(e,r,s){super(),e=jr.normalizeQueryConfig(e,r,s),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new $r(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new $r(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let r;if(!this._canceledDueToError){try{r=this._result.parseRow(e.fields)}catch(s){this._canceledDueToError=s;return}this.emit("row",r,this._result),this._accumulateRows&&this._result.addRow(r)}}handleCommandComplete(e,r){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&r.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,r){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(r){process.nextTick(()=>{throw r})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let r=e.parsedStatements[this.name];return this.text&&r&&this.text!==r?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,r){e.execute({portal:this.portal,rows:r}),r?e.flush():e.sync()}prepare(e){this.isPreparedStatement=!0,this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:jr.prepareValue})}catch(r){this.handleError(r,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,r){}};Hr.exports=Ze});var pt=f(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.NoticeMessage=p.DataRowMessage=p.CommandCompleteMessage=p.ReadyForQueryMessage=p.NotificationResponseMessage=p.BackendKeyDataMessage=p.AuthenticationMD5Password=p.ParameterStatusMessage=p.ParameterDescriptionMessage=p.RowDescriptionMessage=p.Field=p.CopyResponse=p.CopyDataMessage=p.DatabaseError=p.copyDone=p.emptyQuery=p.replicationStart=p.portalSuspended=p.noData=p.closeComplete=p.bindComplete=p.parseComplete=void 0;p.parseComplete={name:"parseComplete",length:5};p.bindComplete={name:"bindComplete",length:5};p.closeComplete={name:"closeComplete",length:5};p.noData={name:"noData",length:5};p.portalSuspended={name:"portalSuspended",length:5};p.replicationStart={name:"replicationStart",length:4};p.emptyQuery={name:"emptyQuery",length:4};p.copyDone={name:"copyDone",length:4};var Xe=class extends Error{constructor(e,r,s){super(e),this.length=r,this.name=s}};p.DatabaseError=Xe;var et=class{constructor(e,r){this.length=e,this.chunk=r,this.name="copyData"}};p.CopyDataMessage=et;var tt=class{constructor(e,r,s,n){this.length=e,this.name=r,this.binary=s,this.columnTypes=new Array(n)}};p.CopyResponse=tt;var rt=class{constructor(e,r,s,n,i,o,u){this.name=e,this.tableID=r,this.columnID=s,this.dataTypeID=n,this.dataTypeSize=i,this.dataTypeModifier=o,this.format=u}};p.Field=rt;var st=class{constructor(e,r){this.length=e,this.fieldCount=r,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};p.RowDescriptionMessage=st;var nt=class{constructor(e,r){this.length=e,this.parameterCount=r,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};p.ParameterDescriptionMessage=nt;var it=class{constructor(e,r,s){this.length=e,this.parameterName=r,this.parameterValue=s,this.name="parameterStatus"}};p.ParameterStatusMessage=it;var ot=class{constructor(e,r){this.length=e,this.salt=r,this.name="authenticationMD5Password"}};p.AuthenticationMD5Password=ot;var at=class{constructor(e,r,s){this.length=e,this.processID=r,this.secretKey=s,this.name="backendKeyData"}};p.BackendKeyDataMessage=at;var ut=class{constructor(e,r,s,n){this.length=e,this.processId=r,this.channel=s,this.payload=n,this.name="notification"}};p.NotificationResponseMessage=ut;var ct=class{constructor(e,r){this.length=e,this.status=r,this.name="readyForQuery"}};p.ReadyForQueryMessage=ct;var ht=class{constructor(e,r){this.length=e,this.text=r,this.name="commandComplete"}};p.CommandCompleteMessage=ht;var lt=class{constructor(e,r){this.length=e,this.fields=r,this.name="dataRow",this.fieldCount=r.length}};p.DataRowMessage=lt;var ft=class{constructor(e,r){this.length=e,this.message=r,this.name="notice"}};p.NoticeMessage=ft});var Vr=f(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.Writer=void 0;var dt=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var r=this.buffer.length-this.offset;if(r<e){var s=this.buffer,n=s.length+(s.length>>1)+e;this.buffer=Buffer.allocUnsafe(n),s.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var r=Buffer.byteLength(e);this.ensure(r+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=r}return this.buffer[this.offset++]=0,this}addString(e=""){var r=Buffer.byteLength(e);return this.ensure(r),this.buffer.write(e,this.offset),this.offset+=r,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let r=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(r,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var r=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),r}};de.Writer=dt});var zr=f(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.serialize=void 0;var yt=Vr(),_=new yt.Writer,Ui=t=>{_.addInt16(3).addInt16(0);for(let s of Object.keys(t))_.addCString(s).addCString(t[s]);_.addCString("client_encoding").addCString("UTF8");var e=_.addCString("").flush(),r=e.length+4;return new yt.Writer().addInt32(r).add(e).flush()},Gi=()=>{let t=Buffer.allocUnsafe(8);return t.writeInt32BE(8,0),t.writeInt32BE(80877103,4),t},$i=t=>_.addCString(t).flush(112),ji=function(t,e){return _.addCString(t).addInt32(Buffer.byteLength(e)).addString(e),_.flush(112)},Hi=function(t){return _.addString(t).flush(112)},Wi=t=>_.addCString(t).flush(81),Yr=[],Vi=t=>{let e=t.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let r=t.types||Yr;for(var s=r.length,n=_.addCString(e).addCString(t.text).addInt16(s),i=0;i<s;i++)n.addInt32(r[i]);return _.flush(80)},N=new yt.Writer,Yi=function(t,e){for(let r=0;r<t.length;r++){let s=e?e(t[r],r):t[r];s==null?(_.addInt16(0),N.addInt32(-1)):s instanceof Buffer?(_.addInt16(1),N.addInt32(s.length),N.add(s)):(_.addInt16(0),N.addInt32(Buffer.byteLength(s)),N.addString(s))}},zi=(t={})=>{let e=t.portal||"",r=t.statement||"",s=t.binary||!1,n=t.values||Yr,i=n.length;return _.addCString(e).addCString(r),_.addInt16(i),Yi(n,t.valueMapper),_.addInt16(i),_.add(N.flush()),_.addInt16(s?1:0),_.flush(66)},Ki=Buffer.from([69,0,0,0,9,0,0,0,0,0]),Ji=t=>{if(!t||!t.portal&&!t.rows)return Ki;let e=t.portal||"",r=t.rows||0,s=Buffer.byteLength(e),n=4+s+1+4,i=Buffer.allocUnsafe(1+n);return i[0]=69,i.writeInt32BE(n,1),i.write(e,5,"utf-8"),i[s+5]=0,i.writeUInt32BE(r,i.length-4),i},Zi=(t,e)=>{let r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(t,8),r.writeInt32BE(e,12),r},mt=(t,e)=>{let s=4+Buffer.byteLength(e)+1,n=Buffer.allocUnsafe(1+s);return n[0]=t,n.writeInt32BE(s,1),n.write(e,5,"utf-8"),n[s]=0,n},Xi=_.addCString("P").flush(68),eo=_.addCString("S").flush(68),to=t=>t.name?mt(68,`${t.type}${t.name||""}`):t.type==="P"?Xi:eo,ro=t=>{let e=`${t.type}${t.name||""}`;return mt(67,e)},so=t=>_.add(t).flush(100),no=t=>mt(102,t),ye=t=>Buffer.from([t,0,0,0,4]),io=ye(72),oo=ye(83),ao=ye(88),uo=ye(99),co={startup:Ui,password:$i,requestSsl:Gi,sendSASLInitialResponseMessage:ji,sendSCRAMClientFinalMessage:Hi,query:Wi,parse:Vi,bind:zi,execute:Ji,describe:to,close:ro,flush:()=>io,sync:()=>oo,end:()=>ao,copyData:so,copyDone:()=>uo,copyFail:no,cancel:Zi};me.serialize=co});var Kr=f(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.BufferReader=void 0;var ho=Buffer.allocUnsafe(0),vt=class{constructor(e=0){this.offset=e,this.buffer=ho,this.encoding="utf-8"}setBuffer(e,r){this.offset=e,this.buffer=r}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let r=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,r}cstring(){let e=this.offset,r=e;for(;this.buffer[r++]!==0;);return this.offset=r,this.buffer.toString(this.encoding,e,r-1)}bytes(e){let r=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r}};ve.BufferReader=vt});var Xr=f(U=>{"use strict";var lo=U&&U.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(U,"__esModule",{value:!0});U.Parser=void 0;var w=pt(),fo=Kr(),po=lo(require("assert")),_t=1,yo=4,Jr=_t+yo,Zr=Buffer.allocUnsafe(0),gt=class{constructor(e){if(this.buffer=Zr,this.bufferLength=0,this.bufferOffset=0,this.reader=new fo.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,r){this.mergeBuffer(e);let s=this.bufferOffset+this.bufferLength,n=this.bufferOffset;for(;n+Jr<=s;){let i=this.buffer[n],o=this.buffer.readUInt32BE(n+_t),u=_t+o;if(u+n<=s){let a=this.handlePacket(n+Jr,i,o,this.buffer);r(a),n+=u}else break}n===s?(this.buffer=Zr,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=s-n,this.bufferOffset=n)}mergeBuffer(e){if(this.bufferLength>0){let r=this.bufferLength+e.byteLength;if(r+this.bufferOffset>this.buffer.byteLength){let n;if(r<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)n=this.buffer;else{let i=this.buffer.byteLength*2;for(;r>=i;)i*=2;n=Buffer.allocUnsafe(i)}this.buffer.copy(n,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=n,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=r}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,r,s,n){switch(r){case 50:return w.bindComplete;case 49:return w.parseComplete;case 51:return w.closeComplete;case 110:return w.noData;case 115:return w.portalSuspended;case 99:return w.copyDone;case 87:return w.replicationStart;case 73:return w.emptyQuery;case 68:return this.parseDataRowMessage(e,s,n);case 67:return this.parseCommandCompleteMessage(e,s,n);case 90:return this.parseReadyForQueryMessage(e,s,n);case 65:return this.parseNotificationMessage(e,s,n);case 82:return this.parseAuthenticationResponse(e,s,n);case 83:return this.parseParameterStatusMessage(e,s,n);case 75:return this.parseBackendKeyData(e,s,n);case 69:return this.parseErrorMessage(e,s,n,"error");case 78:return this.parseErrorMessage(e,s,n,"notice");case 84:return this.parseRowDescriptionMessage(e,s,n);case 116:return this.parseParameterDescriptionMessage(e,s,n);case 71:return this.parseCopyInMessage(e,s,n);case 72:return this.parseCopyOutMessage(e,s,n);case 100:return this.parseCopyData(e,s,n);default:po.default.fail(`unknown message code: ${r.toString(16)}`)}}parseReadyForQueryMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.string(1);return new w.ReadyForQueryMessage(r,n)}parseCommandCompleteMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.cstring();return new w.CommandCompleteMessage(r,n)}parseCopyData(e,r,s){let n=s.slice(e,e+(r-4));return new w.CopyDataMessage(r,n)}parseCopyInMessage(e,r,s){return this.parseCopyMessage(e,r,s,"copyInResponse")}parseCopyOutMessage(e,r,s){return this.parseCopyMessage(e,r,s,"copyOutResponse")}parseCopyMessage(e,r,s,n){this.reader.setBuffer(e,s);let i=this.reader.byte()!==0,o=this.reader.int16(),u=new w.CopyResponse(r,n,i,o);for(let a=0;a<o;a++)u.columnTypes[a]=this.reader.int16();return u}parseNotificationMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i=this.reader.cstring(),o=this.reader.cstring();return new w.NotificationResponseMessage(r,n,i,o)}parseRowDescriptionMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new w.RowDescriptionMessage(r,n);for(let o=0;o<n;o++)i.fields[o]=this.parseField();return i}parseField(){let e=this.reader.cstring(),r=this.reader.int32(),s=this.reader.int16(),n=this.reader.int32(),i=this.reader.int16(),o=this.reader.int32(),u=this.reader.int16()===0?"text":"binary";return new w.Field(e,r,s,n,i,o,u)}parseParameterDescriptionMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new w.ParameterDescriptionMessage(r,n);for(let o=0;o<n;o++)i.dataTypeIDs[o]=this.reader.int32();return i}parseDataRowMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new Array(n);for(let o=0;o<n;o++){let u=this.reader.int32();i[o]=u===-1?null:this.reader.string(u)}return new w.DataRowMessage(r,i)}parseParameterStatusMessage(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.cstring(),i=this.reader.cstring();return new w.ParameterStatusMessage(r,n,i)}parseBackendKeyData(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i=this.reader.int32();return new w.BackendKeyDataMessage(r,n,i)}parseAuthenticationResponse(e,r,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i={name:"authenticationOk",length:r};switch(n){case 0:break;case 3:i.length===8&&(i.name="authenticationCleartextPassword");break;case 5:if(i.length===12){i.name="authenticationMD5Password";let u=this.reader.bytes(4);return new w.AuthenticationMD5Password(r,u)}break;case 10:i.name="authenticationSASL",i.mechanisms=[];let o;do o=this.reader.cstring(),o&&i.mechanisms.push(o);while(o);break;case 11:i.name="authenticationSASLContinue",i.data=this.reader.string(r-8);break;case 12:i.name="authenticationSASLFinal",i.data=this.reader.string(r-8);break;default:throw new Error("Unknown authenticationOk message type "+n)}return i}parseErrorMessage(e,r,s,n){this.reader.setBuffer(e,s);let i={},o=this.reader.string(1);for(;o!=="\0";)i[o]=this.reader.cstring(),o=this.reader.string(1);let u=i.M,a=n==="notice"?new w.NoticeMessage(r,u):new w.DatabaseError(u,r,n);return a.severity=i.S,a.code=i.C,a.detail=i.D,a.hint=i.H,a.position=i.P,a.internalPosition=i.p,a.internalQuery=i.q,a.where=i.W,a.schema=i.s,a.table=i.t,a.column=i.c,a.dataType=i.d,a.constraint=i.n,a.file=i.F,a.line=i.L,a.routine=i.R,a}};U.Parser=gt});var wt=f(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.DatabaseError=O.serialize=O.parse=void 0;var mo=pt();Object.defineProperty(O,"DatabaseError",{enumerable:!0,get:function(){return mo.DatabaseError}});var vo=zr();Object.defineProperty(O,"serialize",{enumerable:!0,get:function(){return vo.serialize}});var _o=Xr();function go(t,e){let r=new _o.Parser;return t.on("data",s=>r.parse(s,e)),new Promise(s=>t.on("end",()=>s()))}O.parse=go});var Et=f((ou,rs)=>{"use strict";var es=require("net"),wo=require("events").EventEmitter,{parse:bo,serialize:E}=wt(),ts=E.flush(),Eo=E.sync(),So=E.end(),bt=class extends wo{constructor(e){super(),e=e||{},this.stream=e.stream||new es.Socket,this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var r=this;this.on("newListener",function(s){s==="message"&&(r._emitMessage=!0)})}connect(e,r){var s=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,r),this.stream.once("connect",function(){s._keepAlive&&s.stream.setKeepAlive(!0,s._keepAliveInitialDelayMillis),s.emit("connect")});let n=function(i){s._ending&&(i.code==="ECONNRESET"||i.code==="EPIPE")||s.emit("error",i)};if(this.stream.on("error",n),this.stream.on("close",function(){s.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(i){var o=i.toString("utf8");switch(o){case"S":break;case"N":return s.stream.end(),s.emit("error",new Error("The server does not support SSL connections"));default:return s.stream.end(),s.emit("error",new Error("There was an error establishing an SSL connection"))}var u=require("tls");let a={socket:s.stream};s.ssl!==!0&&(Object.assign(a,s.ssl),"key"in s.ssl&&(a.key=s.ssl.key)),es.isIP(r)===0&&(a.servername=r);try{s.stream=u.connect(a)}catch(c){return s.emit("error",c)}s.attachListeners(s.stream),s.stream.on("error",n),s.emit("sslconnect")})}attachListeners(e){e.on("end",()=>{this.emit("end")}),bo(e,r=>{var s=r.name==="error"?"errorMessage":r.name;this._emitMessage&&this.emit("message",r),this.emit(s,r)})}requestSsl(){this.stream.write(E.requestSsl())}startup(e){this.stream.write(E.startup(e))}cancel(e,r){this._send(E.cancel(e,r))}password(e){this._send(E.password(e))}sendSASLInitialResponseMessage(e,r){this._send(E.sendSASLInitialResponseMessage(e,r))}sendSCRAMClientFinalMessage(e){this._send(E.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(E.query(e))}parse(e){this._send(E.parse(e))}bind(e){this._send(E.bind(e))}execute(e){this._send(E.execute(e))}flush(){this.stream.writable&&this.stream.write(ts)}sync(){this._ending=!0,this._send(ts),this._send(Eo)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(So,()=>{this.stream.end()})}close(e){this._send(E.close(e))}describe(e){this._send(E.describe(e))}sendCopyFromChunk(e){this._send(E.copyData(e))}endCopyFrom(){this._send(E.copyDone())}sendCopyFail(e){this._send(E.copyFail(e))}};rs.exports=bt});var is=f((uu,ns)=>{"use strict";var Po=require("events").EventEmitter,au=require("util"),Co=ce(),St=Pr(),Ro=Or(),Ao=We(),To=Ke(),ss=Wr(),Mo=ee(),xo=Et(),_e=class extends Po{constructor(e){super(),this.connectionParameters=new To(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var r=e||{};this._Promise=r.Promise||global.Promise,this._types=new Ao(r.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=r.connection||new xo({stream:r.stream,ssl:this.connectionParameters.ssl,keepAlive:r.keepAlive||!1,keepAliveInitialDelayMillis:r.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=r.binary||Mo.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=r.connectionTimeoutMillis||0}_errorAllQueries(e){let r=s=>{process.nextTick(()=>{s.handleError(e,this.connection)})};this.activeQuery&&(r(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(r),this.queryQueue.length=0}_connect(e){var r=this,s=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let n=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(n)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{s._ending=!0,s.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){r.ssl?s.requestSsl():s.startup(r.getStartupConf())}),s.on("sslconnect",function(){s.startup(r.getStartupConf())}),this._attachListeners(s),s.once("end",()=>{let n=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(n),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(n):this._handleErrorEvent(n):this._connectionError||this._handleErrorEvent(n)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((r,s)=>{this._connect(n=>{n?s(n):r()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let r=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(s=>{if(s!==void 0){if(typeof s!="string"){r.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=s}else this.connectionParameters.password=this.password=null;e()}).catch(s=>{r.emit("error",s)}):this.password!==null?e():Ro(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(()=>{let r=Co.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(r)})}_handleAuthSASL(e){this._checkPgPass(()=>{this.saslSession=St.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(e){St.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(e){St.finalizeSession(this.saslSession,e.data),this.saslSession=null}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:r}=this;this.activeQuery=null,this.readyForQuery=!0,r&&r.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let r=this.activeQuery;if(!r){this._handleErrorEvent(e);return}this.activeQuery=null,r.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,r={user:e.user,database:e.database},s=e.application_name||e.fallback_application_name;return s&&(r.application_name=s),e.replication&&(r.replication=""+e.replication),e.statement_timeout&&(r.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(r.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(r.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(r.options=e.options),r}cancel(e,r){if(e.activeQuery===r){var s=this.connection;this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){s.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(r)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(r),1)}setTypeParser(e,r,s){return this._types.setTypeParser(e,r,s)}getTypeParser(e,r){return this._types.getTypeParser(e,r)}escapeIdentifier(e){return'"'+e.replace(/"/g,'""')+'"'}escapeLiteral(e){for(var r=!1,s="'",n=0;n<e.length;n++){var i=e[n];i==="'"?s+=i+i:i==="\\"?(s+=i+i,r=!0):s+=i}return s+="'",r===!0&&(s=" E"+s),s}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,r,s){var n,i,o,u,a;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,i=n=e,typeof r=="function"&&(n.callback=n.callback||r)):(o=this.connectionParameters.query_timeout,n=new ss(e,r,s),n.callback||(i=new this._Promise((c,h)=>{n.callback=(l,d)=>l?h(l):c(d)}))),o&&(a=n.callback,u=setTimeout(()=>{var c=new Error("Query read timeout");process.nextTick(()=>{n.handleError(c,this.connection)}),a(c),n.callback=()=>{};var h=this.queryQueue.indexOf(n);h>-1&&this.queryQueue.splice(h,1),this._pulseQueryQueue()},o),n.callback=(c,h)=>{clearTimeout(u),a(c,h)}),this.binary&&!n.binary&&(n.binary=!0),n._result&&!n._result._types&&(n._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"),this.connection)}),i):(this.queryQueue.push(n),this._pulseQueryQueue(),i):(process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),i)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(r=>{this.connection.once("end",r)})}};_e.Query=ss;ns.exports=_e});var cs=f((cu,us)=>{"use strict";var qo=require("events").EventEmitter,os=function(){},as=(t,e)=>{let r=t.findIndex(e);return r===-1?void 0:t.splice(r,1)[0]},Pt=class{constructor(e,r,s){this.client=e,this.idleListener=r,this.timeoutId=s}},G=class{constructor(e){this.callback=e}};function Io(){throw new Error("Release called on client which has already been released to the pool.")}function ge(t,e){if(e)return{callback:e,result:void 0};let r,s,n=function(o,u){o?r(o):s(u)},i=new t(function(o,u){s=o,r=u});return{callback:n,result:i}}function Oo(t,e){return function r(s){s.client=e,e.removeListener("error",r),e.on("error",()=>{t.log("additional client error after disconnection due to error",s)}),t._remove(e),t.emit("error",s,e)}}var Ct=class extends qo{constructor(e,r){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||r||Rt().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(r=>{this._remove(r.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let r=this._idle.pop();clearTimeout(r.timeoutId);let s=r.client;s.ref&&s.ref();let n=r.idleListener;return this._acquireClient(s,e,n,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e){let r=as(this._idle,s=>s.client===e);r!==void 0&&clearTimeout(r.timeoutId),this._clients=this._clients.filter(s=>s!==e),e.end(),this.emit("remove",e)}connect(e){if(this.ending){let n=new Error("Cannot use a pool after calling end on the pool");return e?e(n):this.Promise.reject(n)}let r=ge(this.Promise,e),s=r.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new G(r.callback)),s;let n=(u,a,c)=>{clearTimeout(o),r.callback(u,a,c)},i=new G(n),o=setTimeout(()=>{as(this._pendingQueue,u=>u.callback===n),i.timedOut=!0,r.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(i),s}return this.newClient(new G(r.callback)),s}newClient(e){let r=new this.Client(this.options);this._clients.push(r);let s=Oo(this,r);this.log("checking client timeout");let n,i=!1;this.options.connectionTimeoutMillis&&(n=setTimeout(()=>{this.log("ending client due to timeout"),i=!0,r.connection?r.connection.stream.destroy():r.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect(o=>{if(n&&clearTimeout(n),r.on("error",s),o)this.log("client failed to connect",o),this._clients=this._clients.filter(u=>u!==r),i&&(o.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(o,void 0,os);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let u=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),this._idle.findIndex(c=>c.client===r)!==-1&&this._acquireClient(r,new G((c,h,l)=>l()),s,!1)},this.options.maxLifetimeSeconds*1e3);u.unref(),r.once("end",()=>clearTimeout(u))}return this._acquireClient(r,e,s,!0)}})}_acquireClient(e,r,s,n){n&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,s),e.removeListener("error",s),r.timedOut?n&&this.options.verify?this.options.verify(e,e.release):e.release():n&&this.options.verify?this.options.verify(e,i=>{if(i)return e.release(i),r.callback(i,void 0,os);r.callback(void 0,e,e.release)}):r.callback(void 0,e,e.release)}_releaseOnce(e,r){let s=!1;return n=>{s&&Io(),s=!0,this._release(e,r,n)}}_release(e,r,s){if(e.on("error",r),e._poolUseCount=(e._poolUseCount||0)+1,s||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses){e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();return}if(this._expired.has(e)){this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();return}let i;this.options.idleTimeoutMillis&&(i=setTimeout(()=>{this.log("remove idle client"),this._remove(e)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&i.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Pt(e,r,i)),this._pulseQueue()}query(e,r,s){if(typeof e=="function"){let i=ge(this.Promise,e);return setImmediate(function(){return i.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),i.result}typeof r=="function"&&(s=r,r=void 0);let n=ge(this.Promise,s);return s=n.callback,this.connect((i,o)=>{if(i)return s(i);let u=!1,a=c=>{u||(u=!0,o.release(c),s(c))};o.once("error",a),this.log("dispatching query");try{o.query(e,r,(c,h)=>{if(this.log("query dispatched"),o.removeListener("error",a),!u)return u=!0,o.release(c),c?s(c):s(void 0,h)})}catch(c){return o.release(c),s(c)}}),n.result}end(e){if(this.log("ending"),this.ending){let s=new Error("Called end on pool more than once");return e?e(s):this.Promise.reject(s)}this.ending=!0;let r=ge(this.Promise,e);return this._endCallback=r.callback,this._pulseQueue(),r.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,r)=>e+(this._expired.has(r)?1:0),0)}get totalCount(){return this._clients.length}};us.exports=Ct});var ls=f((hu,hs)=>{var we=require("path").sep||"/";hs.exports=ko;function ko(t){if(typeof t!="string"||t.length<=7||t.substring(0,7)!="file://")throw new TypeError("must pass in a file:// URI to convert to a file path");var e=decodeURI(t.substring(7)),r=e.indexOf("/"),s=e.substring(0,r),n=e.substring(r+1);return s=="localhost"&&(s=""),s&&(s=we+we+s),n=n.replace(/^(.+)\|/,"$1:"),we=="\\"&&(n=n.replace(/\//g,"\\")),/^.+\:/.test(n)||(n=we+n),s+n}});var ys=f(($,ds)=>{var At=require("fs"),Ee=require("path"),Do=ls(),be=Ee.join,Lo=Ee.dirname,fs=At.accessSync&&function(t){try{At.accessSync(t)}catch{return!1}return!0}||At.existsSync||Ee.existsSync,ps={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function Bo(t){typeof t=="string"?t={bindings:t}:t||(t={}),Object.keys(ps).map(function(a){a in t||(t[a]=ps[a])}),t.module_root||(t.module_root=$.getRoot($.getFileName())),Ee.extname(t.bindings)!=".node"&&(t.bindings+=".node");for(var e=typeof __webpack_require__=="function"?__non_webpack_require__:require,r=[],s=0,n=t.try.length,i,o,u;s<n;s++){i=be.apply(null,t.try[s].map(function(a){return t[a]||a})),r.push(i);try{return o=t.path?e.resolve(i):e(i),t.path||(o.path=i),o}catch(a){if(a.code!=="MODULE_NOT_FOUND"&&a.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(a.message))throw a}}throw u=new Error(`Could not locate the bindings file. Tried:
`+r.map(function(a){return t.arrow+a}).join(`
`)),u.tries=r,u}ds.exports=$=Bo;$.getFileName=function(e){var r=Error.prepareStackTrace,s=Error.stackTraceLimit,n={},i;Error.stackTraceLimit=10,Error.prepareStackTrace=function(u,a){for(var c=0,h=a.length;c<h;c++)if(i=a[c].getFileName(),i!==__filename)if(e){if(i!==e)return}else return},Error.captureStackTrace(n),n.stack,Error.prepareStackTrace=r,Error.stackTraceLimit=s;var o="file://";return i.indexOf(o)===0&&(i=Do(i)),i};$.getRoot=function(e){for(var r=Lo(e),s;;){if(r==="."&&(r=process.cwd()),fs(be(r,"package.json"))||fs(be(r,"node_modules")))return r;if(s===r)throw new Error('Could not find module root given file: "'+e+'". Do you have a `package.json` file? ');s=r,r=be(r,"..")}}});var _s=f((lu,Mt)=>{var y=Mt.exports=ys()("addon.node").PQ,x=require("assert");Mt.parent||(ms=require("path"),console.log(ms.normalize(__dirname+"/src")));var ms,vs=require("events").EventEmitter,x=require("assert");for(Tt in vs.prototype)y.prototype[Tt]=vs.prototype[Tt];var Tt;y.prototype.connectSync=function(t){this.connected=!0,t||(t="");var e=this.$connectSync(t);if(!e){var r=new Error(this.errorMessage());throw this.finish(),r}};y.prototype.connect=function(t,e){this.connected=!0,typeof t=="function"&&(e=t,t=""),t||(t=""),x(e,"Must provide a connection callback"),process.domain&&(e=process.domain.bind(e)),this.$connect(t,e)};y.prototype.errorMessage=function(){return this.$getLastErrorMessage()};y.prototype.socket=function(){return this.$socket()};y.prototype.serverVersion=function(){return this.$serverVersion()};y.prototype.finish=function(){this.connected=!1,this.$finish()};y.prototype.exec=function(t){t||(t=""),this.$exec(t)};y.prototype.execParams=function(t,e){t||(t=""),e||(e=[]),x(Array.isArray(e),"Parameters must be an array"),this.$execParams(t,e)};y.prototype.prepare=function(t,e,r){x.equal(arguments.length,3,"Must supply 3 arguments"),t||(t=""),e||(e=""),r=Number(r)||0,this.$prepare(t,e,r)};y.prototype.execPrepared=function(t,e){t||(t=""),e||(e=[]),x(Array.isArray(e),"Parameters must be an array"),this.$execPrepared(t,e)};y.prototype.sendQuery=function(t){return t||(t=""),this.$sendQuery(t)};y.prototype.sendQueryParams=function(t,e){return t||(t=""),e||(e=[]),x(Array.isArray(e),"Parameters must be an array"),this.$sendQueryParams(t,e)};y.prototype.sendPrepare=function(t,e,r){return x.equal(arguments.length,3,"Must supply 3 arguments"),t||(t=""),e||(e=""),r=Number(r)||0,this.$sendPrepare(t,e,r)};y.prototype.sendQueryPrepared=function(t,e){return t||(t=""),e||(e=[]),x(Array.isArray(e),"Parameters must be an array"),this.$sendQueryPrepared(t,e)};y.prototype.getResult=function(){return this.$getResult()};y.prototype.resultStatus=function(){return this.$resultStatus()};y.prototype.resultErrorMessage=function(){return this.$resultErrorMessage()};y.prototype.resultErrorFields=function(){return this.$resultErrorFields()};y.prototype.clear=function(){this.$clear()};y.prototype.ntuples=function(){return this.$ntuples()};y.prototype.nfields=function(){return this.$nfields()};y.prototype.fname=function(t){return this.$fname(t)};y.prototype.ftype=function(t){return this.$ftype(t)};y.prototype.getvalue=function(t,e){return this.$getvalue(t,e)};y.prototype.getisnull=function(t,e){return this.$getisnull(t,e)};y.prototype.cmdStatus=function(){return this.$cmdStatus()};y.prototype.cmdTuples=function(){return this.$cmdTuples()};y.prototype.startReader=function(){x(this.connected,"Must be connected to start reader"),this.$startRead()};y.prototype.stopReader=function(){this.$stopRead()};y.prototype.writable=function(t){return x(this.connected,"Must be connected to start writer"),this.$startWrite(),this.once("writable",t)};y.prototype.consumeInput=function(){return this.$consumeInput()};y.prototype.isBusy=function(){return this.$isBusy()};y.prototype.setNonBlocking=function(t){return this.$setNonBlocking(t?1:0)};y.prototype.isNonBlocking=function(){return this.$isNonBlocking()};y.prototype.flush=function(){return this.$flush()};y.prototype.escapeLiteral=function(t){return t&&this.$escapeLiteral(t)};y.prototype.escapeIdentifier=function(t){return t&&this.$escapeIdentifier(t)};y.prototype.notifies=function(){return this.$notifies()};y.prototype.putCopyData=function(t){return x(t instanceof Buffer),this.$putCopyData(t)};y.prototype.putCopyEnd=function(t){return t?this.$putCopyEnd(t):this.$putCopyEnd()};y.prototype.getCopyData=function(t){return this.$getCopyData(!!t)};y.prototype.cancel=function(){return this.$cancel()}});var xt=f(gs=>{"use strict";gs.parse=function(t,e){return new k(t,e).parse()};function k(t,e){this.source=t,this.transform=e||Qo,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}k.prototype.isEof=function(){return this.position>=this.source.length};k.prototype.nextCharacter=function(){var t=this.source[this.position++];return t==="\\"?{value:this.source[this.position++],escaped:!0}:{value:t,escaped:!1}};k.prototype.record=function(t){this.recorded.push(t)};k.prototype.newEntry=function(t){var e;(this.recorded.length>0||t)&&(e=this.recorded.join(""),e==="NULL"&&!t&&(e=null),e!==null&&(e=this.transform(e)),this.entries.push(e),this.recorded=[])};k.prototype.parse=function(t){for(var e,r,s;!this.isEof();)if(e=this.nextCharacter(),e.value==="{"&&!s)this.dimension++,this.dimension>1&&(r=new k(this.source.substr(this.position-1),this.transform),this.entries.push(r.parse(!0)),this.position+=r.position-2);else if(e.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),t))return this.entries}else e.value==='"'&&!e.escaped?(s&&this.newEntry(!0),s=!s):e.value===","&&!s?this.newEntry():this.record(e.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries};function Qo(t){return t}});var qt=f((pu,ws)=>{var Fo=xt();ws.exports={create:function(t,e){return{parse:function(){return Fo.parse(t,e)}}}}});var Rs=f((du,Cs)=>{var Pe=xt(),Ce=qt(),Se=xe(),No=Ie(),Es=Oe();function Lt(t){return function(r){return r===null?r:t(r)}}function Ss(t){return t===null?t:t==="TRUE"||t==="t"||t==="true"||t==="y"||t==="yes"||t==="on"||t==="1"}function Uo(t){return t?Pe.parse(t,Ss):null}function Go(t){return parseInt(t,10)}function It(t){return t?Pe.parse(t,Lt(Go)):null}function $o(t){return t?Pe.parse(t,Lt(function(e){return Ps(e).trim()})):null}var jo=function(t){if(!t)return null;var e=Ce.create(t,function(r){return r!==null&&(r=Bt(r)),r});return e.parse()},Ot=function(t){if(!t)return null;var e=Ce.create(t,function(r){return r!==null&&(r=parseFloat(r)),r});return e.parse()},A=function(t){if(!t)return null;var e=Ce.create(t);return e.parse()},kt=function(t){if(!t)return null;var e=Ce.create(t,function(r){return r!==null&&(r=Se(r)),r});return e.parse()},Ho=function(t){return t?Pe.parse(t,Lt(Es)):null},Dt=function(t){return parseInt(t,10)},Ps=function(t){var e=String(t);return/^\d+$/.test(e)?e:t},bs=function(t){var e=A(t);return e&&e.map(function(r){return JSON.parse(r)})},Bt=function(t){return t[0]!=="("?null:(t=t.substring(1,t.length-1).split(","),{x:parseFloat(t[0]),y:parseFloat(t[1])})},Wo=function(t){if(t[0]!=="<"&&t[1]!=="(")return null;for(var e="(",r="",s=!1,n=2;n<t.length-1;n++){if(s||(e+=t[n]),t[n]===")"){s=!0;continue}else if(!s)continue;t[n]!==","&&(r+=t[n])}var i=Bt(e);return i.radius=parseFloat(r),i},Vo=function(t){t(20,Ps),t(21,Dt),t(23,Dt),t(26,Dt),t(700,parseFloat),t(701,parseFloat),t(16,Ss),t(1082,Se),t(1114,Se),t(1184,Se),t(600,Bt),t(651,A),t(718,Wo),t(1e3,Uo),t(1001,Ho),t(1005,It),t(1007,It),t(1028,It),t(1016,$o),t(1017,jo),t(1021,Ot),t(1022,Ot),t(1231,Ot),t(1014,A),t(1015,A),t(1008,A),t(1009,A),t(1040,A),t(1041,A),t(1115,kt),t(1182,kt),t(1185,kt),t(1186,No),t(17,Es),t(114,JSON.parse.bind(JSON)),t(3802,JSON.parse.bind(JSON)),t(199,bs),t(3807,bs),t(3907,A),t(2951,A),t(791,A),t(1183,A),t(1270,A)};Cs.exports={init:Vo}});var qs=f((yu,xs)=>{var Yo=Fe(),g=function(t,e,r,s,n){r=r||0,s=s||!1,n=n||function(b,H,W){return b*Math.pow(2,W)+H};var i=r>>3,o=function(b){return s?~b&255:b},u=255,a=8-r%8;e<a&&(u=255<<8-e&255,a=e),r&&(u=u>>r%8);var c=0;r%8+e>=8&&(c=n(0,o(t[i])&u,a));for(var h=e+r>>3,l=i+1;l<h;l++)c=n(c,o(t[l]),8);var d=(e+r)%8;return d>0&&(c=n(c,o(t[h])>>8-d,d)),c},Ms=function(t,e,r){var s=Math.pow(2,r-1)-1,n=g(t,1),i=g(t,r,1);if(i===0)return 0;var o=1,u=function(c,h,l){c===0&&(c=1);for(var d=1;d<=l;d++)o/=2,(h&1<<l-d)>0&&(c+=o);return c},a=g(t,e,r+1,!1,u);return i==Math.pow(2,r+1)-1?a===0?n===0?1/0:-1/0:NaN:(n===0?1:-1)*Math.pow(2,i-s)*a},zo=function(t){return g(t,1)==1?-1*(g(t,15,1,!0)+1):g(t,15,1)},As=function(t){return g(t,1)==1?-1*(g(t,31,1,!0)+1):g(t,31,1)},Ko=function(t){return Ms(t,23,8)},Jo=function(t){return Ms(t,52,11)},Zo=function(t){var e=g(t,16,32);if(e==49152)return NaN;for(var r=Math.pow(1e4,g(t,16,16)),s=0,n=[],i=g(t,16),o=0;o<i;o++)s+=g(t,16,64+16*o)*r,r/=1e4;var u=Math.pow(10,g(t,16,48));return(e===0?1:-1)*Math.round(s*u)/u},Ts=function(t,e){var r=g(e,1),s=g(e,63,1),n=new Date((r===0?1:-1)*s/1e3+9466848e5);return t||n.setTime(n.getTime()+n.getTimezoneOffset()*6e4),n.usec=s%1e3,n.getMicroSeconds=function(){return this.usec},n.setMicroSeconds=function(i){this.usec=i},n.getUTCMicroSeconds=function(){return this.usec},n},re=function(t){for(var e=g(t,32),r=g(t,32,32),s=g(t,32,64),n=96,i=[],o=0;o<e;o++)i[o]=g(t,32,n),n+=32,n+=32;var u=function(c){var h=g(t,32,n);if(n+=32,h==4294967295)return null;var l;if(c==23||c==20)return l=g(t,h*8,n),n+=h*8,l;if(c==25)return l=t.toString(this.encoding,n>>3,(n+=h<<3)>>3),l;console.log("ERROR: ElementType not implemented: "+c)},a=function(c,h){var l=[],d;if(c.length>1){var b=c.shift();for(d=0;d<b;d++)l[d]=a(c,h);c.unshift(b)}else for(d=0;d<c[0];d++)l[d]=u(h);return l};return a(i,s)},Xo=function(t){return t.toString("utf8")},ea=function(t){return t===null?null:g(t,8)>0},ta=function(t){t(20,Yo),t(21,zo),t(23,As),t(26,As),t(1700,Zo),t(700,Ko),t(701,Jo),t(16,ea),t(1114,Ts.bind(null,!1)),t(1184,Ts.bind(null,!0)),t(1e3,re),t(1007,re),t(1016,re),t(1008,re),t(1009,re),t(25,Xo)};xs.exports={init:ta}});var Os=f(Re=>{var ra=Rs(),sa=qs(),na=qt();Re.getTypeParser=ia;Re.setTypeParser=oa;Re.arrayParser=na;var se={text:{},binary:{}};function Is(t){return String(t)}function ia(t,e){return e=e||"text",se[e]&&se[e][t]||Is}function oa(t,e,r){typeof e=="function"&&(r=e,e="text"),se[e][t]=r}ra.init(function(t,e){se.text[t]=e});sa.init(function(t,e){se.binary[t]=e})});var Ds=f((vu,ks)=>{"use strict";var Qt=class{constructor(e,r){this._types=e,this._arrayMode=r,this.command=void 0,this.rowCount=void 0,this.fields=[],this.rows=[]}consumeCommand(e){this.command=e.cmdStatus().split(" ")[0],this.rowCount=parseInt(e.cmdTuples(),10)}consumeFields(e){let r=e.nfields();for(var s=0;s<r;s++)this.fields.push({name:e.fname(s),dataTypeID:e.ftype(s)})}consumeRows(e){let r=e.ntuples();for(var s=0;s<r;s++){let n=this._arrayMode?this.consumeRowAsArray(e,s):this.consumeRowAsObject(e,s);this.rows.push(n)}}consumeRowAsObject(e,r){let s={};for(var n=0;n<this.fields.length;n++){let i=this.readValue(e,r,n);s[this.fields[n].name]=i}return s}consumeRowAsArray(e,r){let s=[];for(var n=0;n<this.fields.length;n++){let i=this.readValue(e,r,n);s.push(i)}return s}readValue(e,r,s){var n=e.getvalue(r,s);if(n===""&&e.getisnull(r,s))return null;let i=this.fields[s].dataTypeID;return this._types.getTypeParser(i)(n)}};function aa(t,e,r){let s=new Qt(e,r);return s.consumeCommand(t),s.consumeFields(t),s.consumeRows(t),s}ks.exports=aa});var Qs=f((_u,Bs)=>{var Ls=require("stream").Duplex,ua=require("stream").Writable,ca=require("util"),ne=Bs.exports=function(t,e){Ls.call(this,e),this.pq=t,this._reading=!1};ca.inherits(ne,Ls);ne.prototype._write=function(t,e,r){var s=this.pq.putCopyData(t);if(s===1)return r();if(s===-1)return r(new Error(this.pq.errorMessage()));var n=this;this.pq.writable(function(){n._write(t,e,r)})};ne.prototype.end=function(){var t=Array.prototype.slice.call(arguments,0),e=this,r=t.pop();t.length&&this.write(t[0]);var s=this.pq.putCopyEnd();if(s===1)return ha(this.pq,function(i,o){ua.prototype.end.call(e),r&&r(i)});if(s===-1){var n=new Error(this.pq.errorMessage());return this.emit("error",n)}return this.pq.writable(function(){return e.end.apply(e,r)})};ne.prototype._consumeBuffer=function(t){var e=this.pq.getCopyData(!0);if(e instanceof Buffer)return setImmediate(function(){t(null,e)});if(e===-1)return t(null,null);if(e===0){var r=this;return this.pq.once("readable",function(){r.pq.stopReader(),r.pq.consumeInput(),r._consumeBuffer(t)}),this.pq.startReader()}t(new Error("Unrecognized read status: "+e))};ne.prototype._read=function(t){if(!this._reading){this._reading=!0;var e=this;this._consumeBuffer(function(r,s){if(e._reading=!1,r)return e.emit("error",r);s!==!1&&e.push(s)})}};var ha=function(t,e){var r=function(){t.removeListener("readable",n),t.stopReader()},s=function(i){return r(),e(new Error(i||t.errorMessage()))},n=function(){if(!t.consumeInput())return s();if(!t.isBusy())return t.getResult(),t.getResult()&&t.resultStatus()!=="PGRES_COPY_OUT"?s("Only one result at a time is accepted"):t.resultStatus()==="PGRES_FATAL_ERROR"?s():(r(),e(null))};t.on("readable",n),t.startReader()}});var Fs=f((gu,la)=>{la.exports={name:"pg-native",version:"3.0.1",description:"A slightly nicer interface to Postgres over node-libpq",main:"index.js",scripts:{test:"mocha && eslint ."},repository:{type:"git",url:"git://github.com/brianc/node-pg-native.git"},keywords:["postgres","pg","libpq"],author:"Brian M. Carlson",license:"MIT",bugs:{url:"https://github.com/brianc/node-pg-native/issues"},homepage:"https://github.com/brianc/node-pg-native",dependencies:{libpq:"^1.8.10","pg-types":"^1.12.1","readable-stream":"1.0.31"},devDependencies:{async:"^0.9.0","concat-stream":"^1.4.6",eslint:"4.2.0","eslint-config-standard":"10.2.1","eslint-plugin-import":"2.7.0","eslint-plugin-node":"5.1.0","eslint-plugin-promise":"3.5.0","eslint-plugin-standard":"3.0.1","generic-pool":"^2.1.1",lodash:"^2.4.1",mocha:"3.4.2",okay:"^0.3.0",pg:"*",semver:"^4.1.0"},prettier:{printWidth:200}}});var Us=f((wu,Ut)=>{var fa=_s(),Ns=require("events").EventEmitter,pa=require("util"),da=require("assert"),ya=Os(),Ft=Ds(),ma=Qs(),m=Ut.exports=function(t){if(!(this instanceof m))return new m(t);t=t||{},Ns.call(this),this.pq=new fa,this._reading=!1,this._read=this._read.bind(this),this._types=t.types||ya,this.arrayMode=t.arrayMode||!1,this._resultCount=0,this._rows=void 0,this._results=void 0,this.on("newListener",e=>{e==="notification"&&this._startReading()}),this.on("result",this._onResult.bind(this)),this.on("readyForQuery",this._onReadyForQuery.bind(this))};pa.inherits(m,Ns);m.prototype.connect=function(t,e){this.pq.connect(t,e)};m.prototype.connectSync=function(t){this.pq.connectSync(t)};m.prototype.query=function(t,e,r){var s;typeof e=="function"&&(r=e),Array.isArray(e)&&e.length>0?s=function(){return n.pq.sendQueryParams(t,e)}:s=function(){return n.pq.sendQuery(t)};var n=this;n._dispatchQuery(n.pq,s,function(i){if(i)return r(i);n._awaitResult(r)})};m.prototype.prepare=function(t,e,r,s){var n=this,i=function(){return n.pq.sendPrepare(t,e,r)};n._dispatchQuery(n.pq,i,function(o){if(o)return s(o);n._awaitResult(s)})};m.prototype.execute=function(t,e,r){var s=this,n=function(){return s.pq.sendQueryPrepared(t,e)};s._dispatchQuery(s.pq,n,function(i,o){if(i)return r(i);s._awaitResult(r)})};m.prototype.getCopyStream=function(){return this.pq.setNonBlocking(!0),this._stopReading(),new ma(this.pq)};m.prototype.cancel=function(t){da(t,"Callback is required");var e=this.pq.cancel();return setImmediate(function(){t(e===!0?void 0:new Error(e))})};m.prototype.querySync=function(t,e){return e?this.pq.execParams(t,e):this.pq.exec(t),Nt(this.pq),Ft(this.pq,this._types,this.arrayMode).rows};m.prototype.prepareSync=function(t,e,r){this.pq.prepare(t,e,r),Nt(this.pq)};m.prototype.executeSync=function(t,e){return this.pq.execPrepared(t,e),Nt(this.pq),Ft(this.pq,this._types,this.arrayMode).rows};m.prototype.escapeLiteral=function(t){return this.pq.escapeLiteral(t)};m.prototype.escapeIdentifier=function(t){return this.pq.escapeIdentifier(t)};Ut.exports.version=Fs().version;m.prototype.end=function(t){this._stopReading(),this.pq.finish(),t&&setImmediate(t)};m.prototype._readError=function(t){var e=new Error(t||this.pq.errorMessage());this.emit("error",e)};m.prototype._stopReading=function(){!this._reading||(this._reading=!1,this.pq.stopReader(),this.pq.removeListener("readable",this._read))};m.prototype._consumeQueryResults=function(t){return Ft(t,this._types,this.arrayMode)};m.prototype._emitResult=function(t){var e=t.resultStatus();switch(e){case"PGRES_FATAL_ERROR":this._queryError=new Error(this.pq.resultErrorMessage());break;case"PGRES_TUPLES_OK":case"PGRES_COMMAND_OK":case"PGRES_EMPTY_QUERY":let r=this._consumeQueryResults(this.pq);this.emit("result",r);break;case"PGRES_COPY_OUT":case"PGRES_COPY_BOTH":break;default:this._readError("unrecognized command status: "+e);break}return e};m.prototype._read=function(){var t=this.pq;if(!t.consumeInput())return this._readError();if(!t.isBusy()){for(;t.getResult();){let r=this._emitResult(this.pq);if(r==="PGRES_COPY_BOTH"||r==="PGRES_COPY_OUT")break;if(t.isBusy())return}this.emit("readyForQuery");for(var e=this.pq.notifies();e;)this.emit("notification",e),e=this.pq.notifies()}};m.prototype._startReading=function(){this._reading||(this._reading=!0,this.pq.on("readable",this._read),this.pq.startReader())};var Nt=function(t){var e=t.resultErrorMessage()||t.errorMessage();if(e)throw new Error(e)};m.prototype._awaitResult=function(t){return this._queryCallback=t,this._startReading()};m.prototype._waitForDrain=function(t,e){var r=t.flush();if(r===0)return e();if(r===-1)return e(t.errorMessage());var s=this;return t.writable(function(){s._waitForDrain(t,e)})};m.prototype._dispatchQuery=function(t,e,r){this._stopReading();var s=t.setNonBlocking(!0);if(!s)return r(new Error("Unable to set non-blocking to true"));var n=e();if(!n)return r(new Error(t.errorMessage()||"Something went wrong dispatching the query"));this._waitForDrain(t,r)};m.prototype._onResult=function(t){this._resultCount===0?(this._results=t,this._rows=t.rows):this._resultCount===1?(this._results=[this._results,t],this._rows=[this._rows,t.rows]):(this._results.push(t),this._rows.push(t.rows)),this._resultCount++};m.prototype._onReadyForQuery=function(){let t=this._queryCallback;this._queryCallback=void 0;let e=this._queryError;this._queryError=void 0;let r=this._rows;this._rows=void 0;let s=this._results;this._results=void 0,this._resultCount=0,t&&t(e,r||[],s)}});var Gs=f((bu,va)=>{va.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}});var Hs=f((Eu,js)=>{"use strict";var $s=require("events").EventEmitter,_a=require("util"),Gt=ce(),j=js.exports=function(t,e,r){$s.call(this),t=Gt.normalizeQueryConfig(t,e,r),this.text=t.text,this.values=t.values,this.name=t.name,this.callback=t.callback,this.state="new",this._arrayMode=t.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(s){s==="row"&&(this._emitRowEvents=!0)}.bind(this))};_a.inherits(j,$s);var ga={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};j.prototype.handleError=function(t){var e=this.native.pq.resultErrorFields();if(e)for(var r in e){var s=ga[r]||r;t[s]=e[r]}this.callback?this.callback(t):this.emit("error",t),this.state="error"};j.prototype.then=function(t,e){return this._getPromise().then(t,e)};j.prototype.catch=function(t){return this._getPromise().catch(t)};j.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(t,e){this._once("end",t),this._once("error",e)}.bind(this)),this._promise)};j.prototype.submit=function(t){this.state="running";var e=this;this.native=t.native,t.native.arrayMode=this._arrayMode;var r=function(i,o,u){if(t.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),i)return e.handleError(i);e._emitRowEvents&&(u.length>1?o.forEach((a,c)=>{a.forEach(h=>{e.emit("row",h,u[c])})}):o.forEach(function(a){e.emit("row",a,u)})),e.state="end",e.emit("end",u),e.callback&&e.callback(null,u)};if(process.domain&&(r=process.domain.bind(r)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var s=(this.values||[]).map(Gt.prepareValue);if(t.namedQueries[this.name]){if(this.text&&t.namedQueries[this.name]!==this.text){let i=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return r(i)}return t.native.execute(this.name,s,r)}return t.native.prepare(this.name,this.text,s.length,function(i){return i?r(i):(t.namedQueries[e.name]=e.text,e.native.execute(e.name,s,r))})}else if(this.values){if(!Array.isArray(this.values)){let i=new Error("Query values must be an array");return r(i)}var n=this.values.map(Gt.prepareValue);t.native.query(this.text,n,r)}else t.native.query(this.text,r)}});var zs=f((Pu,Ys)=>{"use strict";var wa=Us(),ba=We(),Su=Gs(),Ws=require("events").EventEmitter,Ea=require("util"),Sa=Ke(),Vs=Hs(),R=Ys.exports=function(t){Ws.call(this),t=t||{},this._Promise=t.Promise||global.Promise,this._types=new ba(t.types),this.native=new wa({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var e=this.connectionParameters=new Sa(t);this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};R.Query=Vs;Ea.inherits(R,Ws);R.prototype._errorAllQueries=function(t){let e=r=>{process.nextTick(()=>{r.native=this.native,r.handleError(t)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};R.prototype._connect=function(t){var e=this;if(this._connecting){process.nextTick(()=>t(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(r,s){if(r)return t(r);e.native.connect(s,function(n){if(n)return e.native.end(),t(n);e._connected=!0,e.native.on("error",function(i){e._queryable=!1,e._errorAllQueries(i),e.emit("error",i)}),e.native.on("notification",function(i){e.emit("notification",{channel:i.relname,payload:i.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),t()})})};R.prototype.connect=function(t){if(t){this._connect(t);return}return new this._Promise((e,r)=>{this._connect(s=>{s?r(s):e()})})};R.prototype.query=function(t,e,r){var s,n,i,o,u;if(t==null)throw new TypeError("Client was passed a null or undefined query");if(typeof t.submit=="function")i=t.query_timeout||this.connectionParameters.query_timeout,n=s=t,typeof e=="function"&&(t.callback=e);else if(i=this.connectionParameters.query_timeout,s=new Vs(t,e,r),!s.callback){let a,c;n=new this._Promise((h,l)=>{a=h,c=l}),s.callback=(h,l)=>h?c(h):a(l)}return i&&(u=s.callback,o=setTimeout(()=>{var a=new Error("Query read timeout");process.nextTick(()=>{s.handleError(a,this.connection)}),u(a),s.callback=()=>{};var c=this._queryQueue.indexOf(s);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},i),s.callback=(a,c)=>{clearTimeout(o),u(a,c)}),this._queryable?this._ending?(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"))}),n):(this._queryQueue.push(s),this._pulseQueryQueue(),n):(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"))}),n)};R.prototype.end=function(t){var e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,t));var r;return t||(r=new this._Promise(function(s,n){t=i=>i?n(i):s()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),t&&t()})}),r};R.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};R.prototype._pulseQueryQueue=function(t){if(!!this._connected&&!this._hasActiveQuery()){var e=this._queryQueue.shift();if(!e){t||this.emit("drain");return}this._activeQuery=e,e.submit(this);var r=this;e.once("_done",function(){r._pulseQueryQueue()})}};R.prototype.cancel=function(t){this._activeQuery===t?this.native.cancel(function(){}):this._queryQueue.indexOf(t)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(t),1)};R.prototype.ref=function(){};R.prototype.unref=function(){};R.prototype.setTypeParser=function(t,e,r){return this._types.setTypeParser(t,e,r)};R.prototype.getTypeParser=function(t,e){return this._types.getTypeParser(t,e)}});var $t=f((Cu,Ks)=>{"use strict";Ks.exports=zs()});var Rt=f((Au,ie)=>{"use strict";var Pa=is(),Ca=ee(),Ra=Et(),Aa=cs(),{DatabaseError:Ta}=wt(),Ma=t=>class extends Aa{constructor(r){super(r,t)}},jt=function(t){this.defaults=Ca,this.Client=t,this.Query=this.Client.Query,this.Pool=Ma(this.Client),this._pools=[],this.Connection=Ra,this.types=X(),this.DatabaseError=Ta};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?ie.exports=new jt($t()):(ie.exports=new jt(Pa),Object.defineProperty(ie.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new jt($t())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(ie.exports,"native",{value:t}),t}}))});var Zs=an(Rt()),Js={credentials:{acessKeyId:process.env.ACCESS_KEY,secretAccessKey:process.env.SECRET_ACCESS_KEY},region:"us-east-1",hostname:process.env.HOST,port:process.env.PORT,username:process.env.USER},Ht=new Zs.Client({host:Js.hostname,port:5432,user:Js.username,database:process.env.DATABASE,password:process.env.PASSWORD});exports.handler=async(t,e,r)=>{console.info(`ENVIRONMENT VARIABLES
`+JSON.stringify(process.env,null,2)),console.info(`EVENT
`+JSON.stringify(t,null,2)),console.info(`CONTEXT
`+JSON.stringify(e,null,2)),Ht.connect(u=>{u?console.error("error connecting to RDS",u.stack):console.info("client has connected to RDS")});let s=t.queryStringParameters?.name,n=t.queryStringParameters?.search,i=s||n;console.info("name: "+s),console.info("search: "+n);let o=await Ht.query("SELECT * FROM landlords WHERE name LIKE $1",[`%${i?.toUpperCase()}%`]);return console.info(o),o.rows;Ht?.end(()=>{console.info("the connection has been closed")})};
//# sourceMappingURL=index.js.map
